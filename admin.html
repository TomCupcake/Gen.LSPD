<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>מידע לפיקוד - LSPD</title>
  <link rel="icon" href="LSPD.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* אותו CSS כמו ב-index, רק שינוי קל לכותרות */
    :root { /* אותם משתנים */ }
    /* ... העתק את כל ה-:root ו-styles מ-index אם צריך ... */
    .complaint-card {
      background:var(--glass);
      border:1px solid rgba(90,175,255,0.2);
      border-radius:10px;
      padding:1.4rem;
      margin-bottom:1.4rem;
    }
    .delete-btn {
      background:#ff5e5e;
      color:white;
      border:none;
      padding:0.6rem 1.2rem;
      border-radius:6px;
      cursor:pointer;
    }
  </style>
</head>
<body>

<header>
  <!-- אותו header כמו ב-index -->
  <div class="nav-container">
    <div class="logo-area">
      <img src="LSPD.png" alt="LSPD">
      <span>LSPD</span>
      <span id="userGreeting"></span>
    </div>
    <nav>
      <ul id="mainNavUl">
        <li><a href="index.html">ראשי</a></li>
        <li><a href="command.html" class="active">מידע לפיקוד</a></li>
        <li id="adminMenu" style="display:none;"><a href="admin.html">אדמין פאנל</a></li>
        <li id="logoutMenu" style="display:none;">
          <button class="auth-btn" id="logoutBtn">התנתק</button>
        </li>
      </ul>
      <div class="burger" id="burgerMenu">☰</div>
    </nav>
  </div>
</header>

<main>
  <div class="container" style="padding:2rem 1rem;max-width:1100px;margin:0 auto;">
    <h1>תלונות אנונימיות</h1>
    <div id="complaintsList"></div>
    <p id="noComplaints" style="text-align:center;color:#c3d4e9;display:none;">אין תלונות כרגע</p>
  </div>
</main>

<footer>
  <!-- אותו footer -->
</footer>

<script>
const BIN_ID_COMPLAINTS = '69789c5d43b1c97be94e3c8b';

async function loadComplaints() {
  try {
    const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID_COMPLAINTS}`);
    const d = await r.json();
    return d.record.complaints || [];
  } catch(e) {
    console.error(e);
    return [];
  }
}

async function deleteComplaint(id) {
  if (!confirm('בטוח למחוק?')) return;
  let list = await loadComplaints();
  list = list.filter(c => c.id !== id);
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID_COMPLAINTS}`, {
    method: 'PUT',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({complaints: list})
  });
  render();
}

function render() {
  loadComplaints().then(complaints => {
    const container = document.getElementById('complaintsList');
    container.innerHTML = '';
    document.getElementById('noComplaints').style.display = complaints.length ? 'none' : 'block';

    complaints.forEach(c => {
      const div = document.createElement('div');
      div.className = 'complaint-card';
      div.innerHTML = `
        <strong>${c.subject}</strong><br>
        <small>${c.date}</small><br><br>
        <strong>מפקד:</strong> ${c.commander} • <strong>תג:</strong> ${c.badge}<br><br>
        ${c.content.replace(/\n/g,'<br>')}<br><br>
        ${localStorage.getItem("lspd_currentUser") === "Artzy" ?
          `<button class="delete-btn" onclick="deleteComplaint(${c.id})">מחק</button>` : ''}
      `;
      container.appendChild(div);
    });
  });
}

document.addEventListener('DOMContentLoaded', () => {
  // burger
  const burger = document.getElementById('burgerMenu');
  const navUl  = document.querySelector('#mainNavUl');
  if (burger && navUl) {
    burger.addEventListener('click', () => {
      navUl.classList.toggle('active');
      burger.textContent = navUl.classList.contains('active') ? '✕' : '☰';
    });
  }

  // render complaints
  render();

  // logout
  document.getElementById('logoutBtn')?.addEventListener('click', () => {
    localStorage.removeItem("lspd_loggedIn");
    localStorage.removeItem("lspd_currentUser");
    location.href = "index.html";
  });

  // show admin menu if Artzy
  if (localStorage.getItem("lspd_currentUser") === "Artzy") {
    document.getElementById('adminMenu').style.display = 'list-item';
  }
});
</script>
</body>
</html>